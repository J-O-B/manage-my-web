{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static '/profiles/css/profile.css' %}">
{% endblock %}

{% block page_header %}
    <div class="container header-container">
        <div class="row">
            <div class="col"></div>
        </div>
    </div>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <hr>
            <h1 id="header" class="logo-font mb-4 h2">My Profile</h1>
            {% if orders %}
            <div id="carouselOrders" class="carousel slide" data-ride="carousel">
                <div class="carousel-inner bg-black">
                    <div class="carousel-item text-center active">
                        <p class="lead text-secondary">Your Purchase History</p>
                    </div>
                    {% for line in line_items %}
                    <div class="carousel-item text-center">
                        <p class="lead text-secondary">
                            <span class="mx-2">Name: {{ line.product }} </span> 
                            <span class="mx-2">Quantity: {{ line.quantity }} </span>
                            <span class="mx-2">Total (Excluding Tax): {{ line.lineitem_total }}</span>
                        </p>
                    </div>
                    {% endfor %}
                </div>
                <a class="carousel-control-prev bg-success" href="#carouselOrders" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next bg-success" href="#carouselOrders" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
            {% else %}
            <div class="row text-center">
                <p class="logo-font lead">Looks Like You Dont Have Any Orders... <span class="btn btn-md btn-black"><a href="{% url 'products' %}">Shop Now</a></span></p>
            </div>
            {% endif %}
            <hr>
        </div>
    </div>
</div>

<div class="container-fluid overflow-hidden" id="main-profile-page-wrap">
    <div class="container-fluid my-5">
        <!--Profile Links-->
        <div class="row">
            <div class="col-12 offset-0 col-sm-10 offset-sm-1 col-md-8 offset-md-2 box-shadow relative overflow-hidden" id="profile-dashboard-card">
                <!--Blur-->
                <div class="profile-btn-background glass"></div>

                <!--Image Backgrounds-->
                <div class="profile-btn-background" id="profile-card-background">
                    <img class="h-100 w-100" src="{{ MEDIA_URL }}profile-btn.jpg" alt="Several unopened doors">
                </div>
                <div class="profile-btn-background" id="seo-background">
                    <img class="h-100 w-100" src="{{ MEDIA_URL}}seo-btn.jpg" alt="Several unopened doors">
                </div>
                <div class="profile-btn-background" id="website-profile-background">
                    <img class="h-100 w-100" src="{{ MEDIA_URL}}websites-btn.jpg" alt="Several unopened doors">
                </div>
                <div class="profile-btn-background" id="orders-profile-background">
                    <img class="h-100 w-100" src="{{ MEDIA_URL}}receipt.jpg" alt="Several unopened doors">
                </div>
                <div class="profile-btn-background" id="rating-profile-background">
                    <img class="h-100 w-100" src="{{ MEDIA_URL}}rating.jpg" alt="Several unopened doors">
                </div>

                <!--Buttons-->
                <div class="py-5">
                    <div class="row relative infront">
                        <div class="col-6 offset-3 text-center">
                            <a href="" class="btn btn-lg btn-black p-2 my-2 border w-100 mt-5" id="edit-profile-btn">
                                Edit Profile
                            </a>
                        </div>
                    </div>
                    <div class="row relative infront">
                        <div class="col-6 offset-3 text-center">
                            <a href="" class="btn btn-lg btn-black p-2 my-2 border w-100" id="seo-profile-btn">
                                Search Engine Optimization
                            </a>
                        </div>
                    </div>
                    <div class="row relative infront">
                        <div class="col-6 offset-3 text-center">
                            <a href="" class="btn btn-lg btn-black p-2 my-2 border w-100" id="web-profile-btn">
                                My Websites
                            </a>
                        </div>
                    </div>
                    <div class="row relative infront">
                        <div class="col-6 offset-3 text-center">
                            <a href="" class="btn btn-lg btn-black p-2 my-2 border w-100" id="order-profile-btn">
                                Order History
                            </a>
                        </div>
                    </div>
                    <div class="row relative infront">
                        <div class="col-6 offset-3 text-center">
                            <a href="" class="btn btn-lg btn-black p-2 my-2 border w-100 mb-5" id="meeting-profile-btn">
                                Schedule Meeting
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid overflow-hidden" id="edit-profile">
    <div class="row h-100">
        <div class="col-12 col-md-4 col-lg-3 col-xl-2 text-center py-5 d-block justify-content-middle bg-success" id="menu">
            <h3 class="logo-font mt-3">Menu:</h3>
            <a class="btn btn-md btn-black text-center w-50 my-2" id="edit-profile-details" aria-disabled="false">Edit Profile</a>
            <a class="btn btn-md btn-black text-center w-50 my-2" id="view-seo" aria-disabled="false">SEO</a>
            <a class="btn btn-md btn-black text-center w-50 my-2" id="view-web" aria-disabled="false">Websites</a>
            <a class="btn btn-md btn-black text-center w-50 my-2" id="view-orders" aria-disabled="false">Orders</a>
            <a class="btn btn-md btn-black text-center w-50 my-2" id="view-rating" aria-disabled="false">Ratings</a>
        </div>
        <div class="items col-12 col-md-8 col-lg-9 col-xl-10 py-5 bg-success">
            <div class="w-100 h-100" id="update-profile-info">
                <h3 class="logo-font mt-3 text-center">Update Profile:</h3>
                <div class="w-100 d-flex justify-content-center">
                    <hr class="w-50">
                </div>
                <form action="{% url 'user_profile' %}" method="POST" id="profile-update-form">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-12 offset-0 col-sm-10 offset-sm-1 col-md-8 offset-md-2 col-lg-6 offset-lg-3 text-center">
                            <fieldset class="rounded px-3 mb-5 detailsSet" id="personal-details">
                                <legend class="fieldset-label small text-black mx-2 w-100"><em>Personal Details:</em></legend>
                                {{ form.full_name | as_crispy_field }}
                                {{ form.email | as_crispy_field }}
                                {{ form.phone_number | as_crispy_field }}
                                <p class="btn btn-lg btn-black rounded-0 px-3 my-2" id="go-billing">Next <i class="fas fa-angle-right"></i></p>
                            </fieldset>
                            <fieldset class="rounded px-3 mb-5 billingSet" id="billing-details">
                                <legend class="fieldset-label small text-black mx-2 w-100"><em>Billing Address:</em></legend>
                                {{ form.town_or_city | as_crispy_field }}
                                {{ form.street_address1 | as_crispy_field }}
                                {{ form.street_address2 | as_crispy_field }}
                                {{ form.postcode | as_crispy_field }}
                                {{ form.country | as_crispy_field }}
                                <p>
                                    <span class="btn btn-lg btn-black rounded-0 px-3 my-2" id="go-personal"><i class="fas fa-angle-left"></i> Previous</span>
                                    <span><button type="submit" class="btn btn-lg btn-success btn-outline-black rounded-0 px-3 my-2" id="submit-info">Submit <i class="fas fa-angle-right"></i></button></span>
                                </p>

                            </fieldset>
                        </div>
                    </div>
                </form>
            </div>
            <div class="w-100 h-100" id="seo-info-profile">
                <h3 class="logo-font mt-3 text-center">SEO News:</h3>
                <div class="w-100 d-flex justify-content-center">
                    <hr class="w-50">
                </div>
                <h4 class="h1 text-center text-white">Feature Coming Soon</h4>
                <p class="text-white text-center">
                    Soon our customers will be able to track their SEO rankings and updates automatically 
                    within this tab. This feature will allow you to follow all of our SEO updates, including 
                    strategies, targetted keywords, and ranking.
                </p>
            </div>
            <div class="w-100 h-100" id="orders-profile">
                <h3 class="logo-font mt-3 text-center">Your Orders:</h3>
                <div class="w-100 d-flex justify-content-center">
                    <hr class="w-50">
                </div>
                {% if orders %}
                    <div class="row">
                        <p class="lead h4 text-black text-center">You Have Purchased {{line_items|length}} {% if line_items|length == 1 %}Item{% else %}Items{% endif %}</p>
                        <p class="lead h4 text-black text-center">Total Spent: {{ price }}</p>
                        {% for line in line_items %}
                            <div class="col-12 col-sm-6 col-md-4 col-lg-3 g-3 p-2">
                                <div class="relative box-shadow bg-white overflow-hidden px-2">
                                    <p class="lead text-center">{{ line.product }}</p>
                                    <h1>{{line.product.category}}</h1>
                                    <p class="lead">Price: <span class="small">{{ line.product.price }}</span></p>
                                    <p class="lead">Ordered: <span class="small">{{ line.order.date }}</span></p>
                                    {% if line.delivered %}
                                        <p class="lead">Delivered: <span class="small text-success">{{ line.delivered }}</span></p>
                                    {% else %}
                                        <p class="lead">Delivered: <span class="small text-success">In Progress</span></p>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <div class="w-100 h-100" id="websites-profile">
                <h3 class="logo-font mt-3 text-center">Website:</h3>
                <div class="w-100 d-flex justify-content-center">
                    <hr class="w-50">
                </div>
                {% if websites %}
                    <div class="row">
                        {% for line in websites %}
                            <div class="col-12 col-sm-6 col-md-4 col-lg-3 g-3 p-2">
                                <div class="relative box-shadow bg-white overflow-hidden px-2">
                                    <p class="lead text-center">Product Name: <br><span class="text-success">{{line.product.name}}</span></p>
                                    <p class="lead text-center">Ordered On: <br><span class="text-success">{{line.order.date}}</span></p>
                                    {% if line.delivered %}
                                        <p class="lead text-center">Delivered On: <br><span class="text-success">{{line.delivered}}</span></p>
                                    {% else %}
                                        <p class="lead text-center">Delivered On: <br><span class="fst-italic text-danger">In Progress</span></p>
                                    {% endif %}
                                    {% if line.website %}
                                        <p class="lead text-center">Domain: <br><a href="{{line.website}}" class="text-decoration-none text-success" target="_blank">{{line.website}}</a></p>
                                    {% else %}
                                        <p class="lead text-center">Domain: <br><a href="#" class="text-decoration-none text-danger" target="_blank">No Current Domain</a></p>
                                    {% endif %}
                                    {% if line.subscription %}
                                        <p class="lead text-center">Subscription Expiry: <br><span class="text-success">{{line.order.expiry}}</span></p>
                                    {% else %}
                                        <p class="lead text-center">Subscription Expiry: <br><span class="text-danger">No Subscription</span></p>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                <p class="text-center text-white">
                    It appears as though you have no websites on order with us.
                </p>
                {% endif %}
            </div>
            <div class="w-100 h-100" id="rating-profile">
                <h3 class="logo-font mt-3 text-center">Ratings:</h3>
                <div class="w-100 d-flex justify-content-center">
                    <hr class="w-50">
                </div>
                {% if orders %}
                    <div class="row">
                        {% for line in line_items %}
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 g-3 p-2">
                            <div class="relative box-shadow bg-white overflow-hidden px-2">
                                <p class="lead text-center">{{ line.product }}</p>
                                <p class="lead">Price: <span class="small text-decoration-underline">{{ line.product.price }}</span></p>
                                <p class="lead">Ordered: <span class="small text-decoration-underline">{{ line.order.date }}</span></p>
                                {% if line.delivered %}
                                    <p class="lead">Delivered: <span class="small text-success text-decoration-underline">{{ line.delivered }}</span></p>
                                {% else %}
                                    <p class="lead">Delivered: <span class="small text-success text-decoration-underline">In Progress</span></p>
                                {% endif %}
                                {% if line.rating %}
                                <p class="text muted">You Rated This Product: {{ line.rating|floatformat:1 }} / 5.0 <br><span class="fst-italic">Thank You For Your Feedback</span></p>
                                {% else %}
                                <p class="text-muted">Please Provide Feedback For This Product</p>
                                <form action="{% url 'user_profile' %}" method="POST" id="{{line.order.id}}">
                                    {% csrf_token %}
                                    <input type="hidden" name="ratingForm" class="ratingForm_{{line.order.id}}">
                                    <input type="hidden" name="productID" class="productID" value="{{line.product.id}}">
                                    <input type="hidden" name="orderID" class="orderID" value="{{line.order.id}}">
                                    <button type="submit" class="hidden submit-rating" id="submit-rating-{{line.order.id}}">Submit Rating</button>
                                </form>
                                <div class="row">
                                    <p class="w-100 d-flex justify-content-around">
                                        <span class="pointer star1" onclick="rating(1, {{line.product.id}}, {{line.order.id}})"><i class="far fa-star"></i></span>
                                        <span class="pointer star2" onclick="rating(2, {{line.product.id}}, {{line.order.id}})"><i class="far fa-star"></i></span>
                                        <span class="pointer star3" onclick="rating(3, {{line.product.id}}, {{line.order.id}})"><i class="far fa-star"></i></span>
                                        <span class="pointer star4" onclick="rating(4, {{line.product.id}}, {{line.order.id}})"><i class="far fa-star"></i></span>
                                        <span class="pointer star5" onclick="rating(5, {{line.product.id}}, {{line.order.id}})"><i class="far fa-star"></i></span>
                                    </p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block postloadjs %}
    {{ block.super }}
    <script type="text/javascript">
    $(document).ready(function(){
        mainPageWrap();
        sideMenuOptions();
    })
    function equalHeight(height){
        $('#menu').css('height', height).css("vertical-align", 'middle');
    }
    function mainPageWrap(){
        
        $('#edit-profile').hide();
        // Main Menu Options
            $('#edit-profile-btn').click(function(e){
                e.preventDefault();
                $('#main-profile-page-wrap').hide(200);
                $('#edit-profile').show(500);
                $('#update-profile-info').siblings().hide();
                $('#update-profile-info').show(200);
            })
            $('#seo-profile-btn').click(function(e){
                e.preventDefault();
                $('#main-profile-page-wrap').hide(200);
                $('#edit-profile').show(500);
                $('#seo-info-profile').siblings().hide();
                $('#seo-info-profile').show(200);
            })
            $('#web-profile-btn').click(function(e){
                e.preventDefault();
                $('#main-profile-page-wrap').hide(200);
                $('#edit-profile').show(500);
                $('#websites-profile').siblings().hide();
                $('#websites-profile').show(200);
            })
            $('#order-profile-btn').click(function(e){
                e.preventDefault();
                $('#main-profile-page-wrap').hide(200);
                $('#edit-profile').show(500);
                $('#orders-profile').siblings().hide();
                $('#orders-profile').show(200);
            })
            $('#meeting-profile-btn').click(function(e){
                e.preventDefault();
                $('#main-profile-page-wrap').hide(200);
                $('#edit-profile').show(500);
                $('#rating-profile').siblings().hide();
                $('#rating-profile').show(200);
            })

        // Styling
        $('#seo-info').hide();
        $('#billing-details').hide();
        $('#edit-profile').hide();
        $('#seo-background').hide();
        $('#profile-card-background').hide();
        $('#website-profile-background').hide();
        $('#orders-profile-background').hide();
        $('#rating-profile-background').hide();

        $('#go-billing').click(function(){
            $('#personal-details').hide();
            $('#billing-details').slideDown();
        })
        $('#go-personal').click(function(){
            $('#billing-details').hide();
            $('#personal-details').slideDown();
        })
        
        $('#edit-profile-btn').mouseenter(function(){
            $('#profile-card-background').fadeIn(300);
            $('#main-profile-page-wrap').css('background', '#333333').css('transition', 'all 2s ease-in-out');
        })
        $('#edit-profile-btn').mouseleave(function(){
            $('#profile-card-background').fadeOut(300);
            $('#main-profile-page-wrap').css('background', '#f5f5f5');
        })
        $('#seo-profile-btn').mouseenter(function(){
            $('#seo-background').fadeIn(300);
            $('#main-profile-page-wrap').css('background', '#333333').css('transition', 'all 2s ease-in-out');
        })
        $('#seo-profile-btn').mouseleave(function(){
            $('#seo-background').fadeOut(300);
            $('#main-profile-page-wrap').css('background', '#f5f5f5');
        })
        $('#web-profile-btn').mouseenter(function(){
            $('#website-profile-background').fadeIn(300);
            $('#main-profile-page-wrap').css('background', '#333333').css('transition', 'all 2s ease-in-out');
        })
        $('#web-profile-btn').mouseleave(function(){
            $('#website-profile-background').fadeOut(300);
            $('#main-profile-page-wrap').css('background', '#f5f5f5');
        })
        $('#order-profile-btn').mouseenter(function(){
            $('#orders-profile-background').fadeIn(300);
            $('#main-profile-page-wrap').css('background', '#333333').css('transition', 'all 2s ease-in-out');
        })
        $('#order-profile-btn').mouseleave(function(){
            $('#orders-profile-background').fadeOut(300);
            $('#main-profile-page-wrap').css('background', '#f5f5f5');
        })
        $('#meeting-profile-btn').mouseenter(function(){
            $('#rating-profile-background').fadeIn(300);
            $('#main-profile-page-wrap').css('background', '#333333').css('transition', 'all 2s ease-in-out');
        })
        $('#meeting-profile-btn').mouseleave(function(){
            $('#rating-profile-background').fadeOut(300);
            $('#main-profile-page-wrap').css('background', '#f5f5f5');
        })
    }
    function sideMenuOptions(){
        $('#edit-profile-details').click(function(){
            $('#update-profile-info').siblings().hide(200);
            $('#update-profile-info').show(500);
        })
        $('#view-seo').click(function(){
            $('#seo-info-profile').siblings().hide(200);
            $('#seo-info-profile').show(500);
        })
        $('#view-web').click(function(){
            $('#websites-profile').siblings().hide(200);
            $('#websites-profile').show(500);
        })
        $('#view-orders').click(function(){
            $('#orders-profile').siblings().hide(200);
            $('#orders-profile').show(500);
        })
        $('#view-rating').click(function(){
            $('#rating-profile').siblings().hide(200);
            $('#rating-profile').show(500);
        })
    }
    
    function rating(rating, product_id, order_id){
        $(`.ratingForm_${order_id}`).val(rating);
        $(`#submit-rating-${order_id}`).trigger('click');
    }
    // Stars Style
    function stars(){   
        $('.star1').mouseenter(function(){
            $(this).prevAll().children().removeClass('far').addClass('fas');
            $(this).children().removeClass('far').addClass('fas');
        });
        $('.star1').mouseleave(function(){
            $(this).prevAll().children().removeClass('fas').addClass('far');
            $(this).children().removeClass('fas').addClass('far');
        });
        
        $('.star2').mouseenter(function(){
            $(this).prevAll().children().removeClass('far').addClass('fas');
            $(this).children().removeClass('far').addClass('fas');
        });
        $('.star2').mouseleave(function(){
            $(this).prevAll().children().removeClass('fas').addClass('far');
            $(this).children().removeClass('fas').addClass('far');
        });
        
        $('.star3').mouseenter(function(){
            $(this).prevAll().children().removeClass('far').addClass('fas');
            $(this).children().removeClass('far').addClass('fas');
        });
        $('.star3').mouseleave(function(){
            $(this).prevAll().children().removeClass('fas').addClass('far');
            $(this).children().removeClass('fas').addClass('far');
        });
        
        $('.star4').mouseenter(function(){
            $(this).prevAll().children().removeClass('far').addClass('fas');
            $(this).children().removeClass('far').addClass('fas');
        });
        $('.star4').mouseleave(function(){
            $(this).prevAll().children().removeClass('fas').addClass('far');
            $(this).children().removeClass('fas').addClass('far');
        });
        
        $('.star5').mouseenter(function(){
            $(this).prevAll().children().removeClass('far').addClass('fas');
            $(this).children().removeClass('far').addClass('fas');
        });
        $('.star5').mouseleave(function(){
            $(this).prevAll().children().removeClass('fas').addClass('far');
            $(this).children().removeClass('fas').addClass('far');
        });
        
    }
    stars();
    </script>
{% endblock %}
