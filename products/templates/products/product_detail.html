{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/products.css' %}"> 
{% endblock %}

{% block page_header %}
    <div class="container header-container">
        <div class="row">
            <div class="col"></div>
        </div>
    </div>
{% endblock %}

{% block content %}

    <div class="container-fluid mt-5">
        <div class="row g-3 m-0">
            <div class="col-12 col-md-6 col-lg-4 offset-lg-2">
                <div class="image-container my-0">
                    {% if product.image1 %}
                        <a href="{{ product.image1.url }}" target="_blank">
                            <img src="{{ product.image1.url }}" alt="{{ product.name }}" class="card-img-top img-fluid details-top-image">
                        </a>
                    {% else %}
                        <a href="">
                            <img src="{{ MEDIA_URL }}noimage.jpg" alt="{{ MEDIAURL }}noimage.jpg" class="card-img-top img-fluid">
                        </a>
                    {% endif %}
                    <div class="row px-3 d-flex justify-content-evenly align-items-center text-center">
                        <div class="col-3 p-1 box-shadow pointer detail-bottom-images">
                            {% if product.image2 %}
                                <img src="{{ product.image2.url }}" alt="{{ product.name }} image two" class="img-fluid">
                            {% else %}
                                <a href="">
                                    <img src="{{ MEDIA_URL }}noimage.jpg" alt="{{ product.name }} image two" class="card-img-top img-fluid">
                                </a>
                            {% endif %}
                        </div>
                        <div class="col-3 p-1 box-shadow pointer detail-bottom-images">
                            {% if product.image3 %}
                                <img src="{{ product.image3.url }}" alt="{{ product.name }} image three" class="img-fluid">
                            {% else %}
                                <a href="">
                                    <img src="{{ MEDIA_URL }}noimage.jpg" alt="{{ product.name }} image three" class="card-img-top img-fluid">
                                </a>
                            {% endif %}
                        </div>
                        <div class="col-3 p-1 box-shadow pointer detail-bottom-images">
                            {% if product.image4 %}
                                <img src="{{ product.image4.url }}" alt="{{ product.name }} image four" class="img-fluid">
                            {% else %}
                                <a href="">
                                    <img src="{{ MEDIA_URL }}noimage.jpg" alt="{{ product.name }} image four" class="card-img-top img-fluid">
                                </a>
                            {% endif %}
                        </div>
                        <div class="col-3 p-1 box-shadow pointer detail-bottom-images">
                            {% if product.image5 %}
                                <img src="{{ product.image5.url }}" alt="{{ product.name }} image five" class="img-fluid">
                            {% else %}
                                <a href="">
                                    <img src="{{ MEDIA_URL }}noimage.jpg" alt="{{ product.name }} image five" class="card-img-top img-fluid">
                                </a>    
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-6 col-lg-4 box-shadow">
                <div class="product-details-container mb-5 mx-4 mt-md-5">
                    <h1 class="h5 mb-0 logo-font">{{product.name}}</h1>
                    {% if product.category %}
                        <p class="small mt-1 mb-0">
                            <a href="{% url 'products' %}?category={{product.category.name}}" class="text-muted">
                                <i class="fas fa-tag mr-1"></i> {{product.category.friendly_name}}
                            </a>
                        </p>
                    {% endif %}
                    <p class="lead mb-0 text-start font-weight-bold">
                        {% if product.on_sale == 2 %}
                            <span class="text-danger"><del>€{{product.normal_price}}</del></span>
                            <i class="fas fa-angle-double-right"></i>
                            <span class="text-success">€{{product.price}}</span><br>
                            <span class="text-success small"><small>{{saving|floatformat:2}}% Saving</small></span>
                        {% else %}
                            <span class="text-success">€{{product.price}}</span>
                        {% endif %}
                        {% if product.plan == 2 %}
                            <span class="text-muted">/ Year</span>
                        {% endif %}
                    </p>
                    {% if product.rating %}
                        <small class="text-muted"><i class="fas fa-star mr-1"></i>{{ product.rating|floatformat:2 }} / 5.00</small>
                    {% else %}
                        <small class="text-muted">No Rating</small>
                    {% endif %}
                    <p class="mt-3">{{ product.summary }}</p>
                    <div class="row">
                        <div class="col-10 offset-1 text-center">
                            <form action="{% url 'add_to_cart' product.id %}" method="POST" class="form">
                                {% csrf_token %}
                                <div class="form-row">
                                    <div class="col-12">
                                        <p class="mt-3">
                                            <strong>
                                            {% if product.plan == 2 %}
                                                <em class="btn-outline-black bg-success text-black px-3 py-1"><u>Subscription Based Item</u></em>
                                            {% else %}
                                                <em class="text-black"><u>Qantity</u></em>
                                            {% endif %}
                                            </strong>
                                        </p>
                                        <div class="form-group">
                                            <div class="input-group">
                                                {% if product.plan == 1 %}
                                                    <div class="input-group-prepend">
                                                        <button class="decrement-qty btn btn-black rounded-0"
                                                            data-item-id="{{product.id}}" id="decrement-qty_{{ product.id }}">
                                                            <span class="icon">
                                                                <i class="fas fa-minus"></i>
                                                            </span>
                                                        </button>
                                                    </div>
                                                    <input type="number" class="form-control qty_input" 
                                                        name="quantity" value="1" min="1" max="{% if product.available %}{{product.available}}{% else %}10{% endif %}" 
                                                        data-item_id={{product.id}} id="id_qty_{{product.id}}">
                                                    <input type="hidden" value="{{product.available}}" id="productAvailability">
                                                    <div class="input-group-append">
                                                        <button class="increment-qty btn btn-black rounded-0"
                                                            data-item-id="{{product.id}}" id="increment-qty_{{ product.id }}">
                                                            <span class="icon">
                                                                <i class="fas fa-plus"></i>
                                                            </span>
                                                        </button>
                                                    </div>
                                                {% elif product.plan == 2 %}
                                                    <input type="hidden" name="quantity" value="1" data-item_id={{product.id}} id="id_qty_{{product.id}}">
                                                    <p class="text-center small">
                                                        This product is a subscription based product. The price indicated is a 1 year fee for this service. <br>
                                                        For further information, please review the <a href="#subscription" class="text-decoration-none">subscription section</a> below.
                                                    </p>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <a href="{% url 'products' %}" class="btn btn-outline-black rounded-0 mt-5">
                                            <span class="icon">
                                                <i class="fas fa-chevron-left"></i>
                                            </span>
                                            <span class="text-uppercase">Keep Shopping</span>
                                        </a>
                                        <button type="submit" class="btn btn-primary btn-outline-black rounded-0 text-uppercase mt-5">
                                            <i class="fas fa-cart-plus fa-lg"></i> 
                                            <span class="text-uppercase">Add To Cart</span>
                                        </button>
                                    </div>
                                    <input type="hidden" name="redirect_url" value="{{ request.path }}">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row g-3 m-0">
            <div class="col-12 col-md-12 col-lg-8 offset-lg-2 box-shadow">
                <h2 class="text-black text-center pt-3">
                    {{ product.name|title }} Description:
                </h2>
                <hr class="pb-1 w-25 mx-auto">
                <p class="text-black text-justify px-5">
                    {{product.description}}
                </p>
            </div>
        </div>
        {% if product.plan == 2 %}
        <div class="row g-3 m-0" id="subscription">
            <div class="col-12 col-md-12 col-lg-8 offset-lg-2 box-shadow">
                <h2 class="text-black text-center pt-3">
                    Subscription Explained
                </h2>
                <hr class="pb-1 w-25 mx-auto">
                <p class="text-black text-justify px-5">
                    Subscriptions with Manage My Web is the ultimate option in bringing your business or portfolio online.
                    With our subscription plans, you will not only get the product as stated, but also a domain, hosting, 
                    developer support, website optimization and updates, search engine optimization and more. <br><br>
                    A full list of whats included in subcription plans can be found on our <a href="#" class="text-decoration-none">pricing page</a>.
                </p>
            </div>
        </div>
        {% endif %}
    </div>

{% endblock %}
{% block postloadjs %}
    {{ block.super }}
    {% include 'includes/quantity_input_script.html' %}
{% endblock %}
